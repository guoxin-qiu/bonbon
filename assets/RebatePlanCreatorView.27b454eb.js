var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,r=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,n=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(l)for(var a of l(t))d.call(t,a)&&r(e,a,t[a]);return e},i=(e,l)=>t(e,a(l)),u=(e,t,a)=>new Promise(((l,o)=>{var d=e=>{try{n(a.next(e))}catch(t){o(t)}},r=e=>{try{n(a.throw(e))}catch(t){o(t)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(d,r);n((a=a.apply(e,t)).next())}));import{_ as s}from"./index.9b869bd5.js";import{d as p,r as m,bj as c,aV as f,aW as h,aS as V,a as b,aX as _,a$ as x,az as y,ae as v,aR as g,ay as C,a_ as w,cf as U,ac as k,bk as R,b0 as q,cj as M,ck as L,bn as D,aQ as F,bR as T,cl as I,bK as j}from"./index.44eff430.js";import{r as A}from"./routerHelper.692f5c09.js";import{g as P,a as B}from"./vxeTableHelper.6baae079.js";import{a as S,b as K,c as N,d as G}from"./retail-rebate-plan.service.60436be3.js";import{_ as O}from"./index.69084706.js";import{_ as z}from"./index.eb643f6e.js";import{_ as Q}from"./index.efd20b46.js";import{_ as Y}from"./index.a39b0902.js";import{_ as $}from"./index.9fcc5db4.js";import{_ as H}from"./index.b422e771.js";import{_ as E}from"./index.dd62f48c.js";import"./dayjs.min.7438ea6f.js";import"./master-data.service.95993c0c.js";import"./retail-master-data.service.de057498.js";const W=x(p({__name:"MainFormView",props:{disabled:{type:Boolean,required:!1},afterSaveSuccess:{type:Function,required:!1},formData:{type:null,required:!0}},setup(e){const t=e,a=m(),l={planType:[{required:!0}],quarter:[{required:!0}],planName:[{required:!0}],dimension:[{required:!0}]};return(o,d)=>{const r=z,n=c("vxe-form-item"),i=O,u=c("vxe-input"),s=c("vxe-form");return f(),h(s,{"title-align":"right","title-width":"180",data:e.formData,rules:l,ref_key:"mainForm",ref:a},{default:V((()=>[b(n,{field:"planType",title:"方案类型",span:11},{default:V((({data:e})=>[b(r,{modelValue:e.planType,"onUpdate:modelValue":t=>e.planType=t,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),b(n,{field:"year",title:"季度",span:11},{default:V((({data:e})=>[b(i,{modelValue:e.quarter,"onUpdate:modelValue":t=>e.quarter=t,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),b(n,{field:"planName",title:"方案名称",span:22},{default:V((({data:e})=>[b(u,{modelValue:e.planName,"onUpdate:modelValue":t=>e.planName=t,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),_(' <vxe-form-item field="customerCategory" title="KA属性" :span="11">\n      <template #default="{ data }">\n        <DemoRetailCustomerCategory\n          v-model="data.customerCategory"\n          multiple\n          :disabled="props.disabled"\n        />\n      </template>\n    </vxe-form-item> '),_(' <vxe-form-item field="customerLevelType" title="客户级别类型" :span="11">\n      <template #default="{ data }">\n        <DemoRetailCustomerLevelType v-model="data.customerLevelType" :disabled="props.disabled" />\n      </template>\n    </vxe-form-item> '),_(' <vxe-form-item field="productMix" title="产品组合" :span="22">\n      <template #default="{ data }">\n        <DemoProductMix v-model="data.productMix" multiple :disabled="props.disabled" />\n      </template>\n    </vxe-form-item> '),b(n,{field:"startDate",title:"方案开始日期",span:11,titlePrefix:{content:"根据方案开始季度自动赋值"}},{default:V((({data:e})=>[b(u,{modelValue:e.startDate,"onUpdate:modelValue":t=>e.startDate=t,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(n,{field:"endDate",title:"方案结束日期",span:11,titlePrefix:{content:"根据方案结束季度自动赋值"}},{default:V((({data:e})=>[b(u,{modelValue:e.endDate,"onUpdate:modelValue":t=>e.endDate=t,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),_(' <vxe-form-item align="center" title-align="left" :span="24">\n      <template #default>\n        <vxe-button type="submit" status="primary" @click="saveMainInfo">保存数据</vxe-button>\n      </template>\n    </vxe-form-item> ')])),_:1},8,["data"])}}}),[["__scopeId","data-v-7c6502c3"],["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/MainFormView.vue"]]);function X(e,t){const a=[...e];return t.includes("协议目标金额")&&(a.push({field:"agreedTargetAmountLL",title:"协议目标金额下限",width:180,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"agreedTargetAmountUL",title:"协议目标金额上限",width:180,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("达成率")&&(a.push({field:"achieveRateLL",title:"达成率下限",width:150,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"achieveRateUL",title:"达成率上限",width:150,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("产品增长率")&&(a.push({field:"productGrowthRateLL",title:"产品增长率下限",width:180,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"productGrowthRateUL",title:"产品增长率上限",width:180,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("产品贡献率")&&(a.push({field:"productContributionRateLL",title:"产品贡献率下限",width:180,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"productContributionRateUL",title:"产品贡献率上限",width:180,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("项目达成金额")&&(a.push({field:"achieveAmountLL",title:"项目达成金额下限",width:180,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"achieveAmountUL",title:"项目达成金额上限",width:180,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("增长金额")&&(a.push({field:"increaseAmountLL",title:"增长金额下限",width:180,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"increaseAmountUL",title:"增长金额上限",width:180,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("存量/增量支付比例")&&(a.push({field:"basePaymentRatio",title:"存量支付比例",width:150,editRender:{name:"input",attrs:{type:"number"}}}),a.push({field:"incrementPaymentRatio",title:"增量支付比例",width:150,editRender:{name:"input",attrs:{type:"number"}}})),t.includes("折扣系数")&&a.push({field:"discountFactor",title:"折扣系数",width:150,editRender:{name:"input",attrs:{type:"number"}}}),t.includes("折扣比例")&&a.push({field:"discountRatio",title:"折扣比例",width:150,editRender:{name:"input",attrs:{type:"number"}}}),a}const J=R("div",{style:{color:"silver"}},[R("span",null,"此段文字仅需求说明，非页面元素。"),R("br"),R("span",null," 页面对于区间是否有交叉不做校验。如果有多个交叉的错误数据，以匹配的第一个作为计算值。 "),R("br"),R("span",null,"都输入小数，不用转换百分比；小数4位。"),R("br"),R("span",null,"下限不填写默认为无穷小，上限不填默认为无穷大；"),R("br"),R("span",null,"计算为 大于等于下限，小于上限；"),R("br"),R("span",null,"如果公式中有使用到，折扣系数如果取不到，默认为1来计算。")],-1),Z=x(p({__name:"DiscountFactorCreatorView",props:{afterSaveSuccess:{type:Function,required:!0}},setup(e){const t=e,a=m(),l=m(),o=y({customerCategory:[],productMix:[],customerLevel:[],headquarter:[],product:[],dimension:[]}),d={},r=y(i(n({},P("ruleGrid")),{data:[],pagerConfig:void 0,columns:[],editConfig:{trigger:"click",mode:"row",showStatus:!0}})),s=()=>u(this,null,(function*(){var e;null==(e=l.value)||e.insertAt({},-1)})),p=()=>u(this,null,(function*(){var e;null==(e=l.value)||e.removeCheckboxRow()}));return v(o.dimension,(()=>{r.columns=X([{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"}],o.dimension)})),(e,n)=>{const i=E,u=c("vxe-form-item"),m=Y,h=H,x=$,y=Q,v=c("vxe-checkbox"),R=c("vxe-checkbox-group"),q=c("vxe-form"),M=c("vxe-button"),L=c("vxe-grid");return f(),g(k,null,[b(q,{"title-align":"right","title-width":"180",data:C(o),rules:d,ref_key:"xForm",ref:a},{default:V((()=>[b(u,{field:"customerCategory",title:"KA属性",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(i,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"productMix",title:"产品组合",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(m,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"customerLevel",title:"客户级别",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(h,{modelValue:e.customerLevel,"onUpdate:modelValue":t=>e.customerLevel=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"headquarter",title:"总部",span:11,"title-prefix":{content:"根据方案主体中的Q筛选下拉框内容；多选后生成笛卡尔积；"}},{default:V((({data:e})=>[b(x,{modelValue:e.headquarter,"onUpdate:modelValue":t=>e.headquarter=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"product",title:"产品",span:11,"title-prefix":{content:"根据所选产品组中的产品；可多选"}},{default:V((({data:e})=>[b(y,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{"title-width":"100",field:"dimension",title:"维度",span:24},{default:V((({data:e})=>[b(R,{modelValue:e.dimension,"onUpdate:modelValue":t=>e.dimension=t},{default:V((()=>[_(' <vxe-checkbox label="协议目标金额" content="协议目标金额" /> '),b(v,{label:"达成率",content:"达成率"}),b(v,{label:"产品增长率",content:"产品增长率"}),_(' <vxe-checkbox label="产品贡献率" content="产品贡献率" /> '),b(v,{label:"项目达成金额",content:"项目达成金额"}),_(' <vxe-checkbox label="存量/增量支付比例" content="存量/增量支付比例" /> '),b(v,{label:"折扣系数",content:"折扣系数"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),J,b(L,U({ref_key:"xGrid",ref:l},C(r)),{toolbar_buttons:V((()=>[b(M,{onClick:s,status:"primary"},{default:V((()=>[w("添加行")])),_:1}),b(M,{onClick:p,status:"primary"},{default:V((()=>[w("删除行")])),_:1})])),_:1},16),b(q,{"title-align":"right","title-width":"180",data:C(o),rules:d,ref_key:"xForm",ref:a},{default:V((()=>[b(u,{align:"center","title-align":"left",span:24},{default:V((()=>[b(M,{status:"primary",onClick:n[0]||(n[0]=e=>C(B)("需校验KA属性+客户级别+总部+产品组合+产品是否存在，如有则添加失败，给出提示").then((()=>{t.afterSaveSuccess()})))},{default:V((()=>[w(" 确认添加 ")])),_:1})])),_:1})])),_:1},8,["data"])],64)}}}),[["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/DiscountFactorCreatorView.vue"]]),ee=x(p({__name:"DiscountFactorListView",props:{disabled:{type:Boolean,required:!1},planId:{type:String,required:!1}},setup(e){const t=e,a=y({showRuleCreator:!1}),l=y(i(n({},P("ruleGrid",(e=>K(n({planId:t.planId},e))))),{formConfig:{items:[{folding:!1,slots:{default:"search_customerCategory"}},{folding:!1,slots:{default:"search_customerLevel"}},{folding:!1,slots:{default:"search_productMix"}},{folding:!0,slots:{default:"search_headquarter"}},{folding:!0,slots:{default:"search_product"}},{collapseNode:!0,itemRender:{},slots:{default:"search_operation"}}]},columns:[]}));function o(e){l.columns=X([{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"},{field:"customerCategory",title:"KA属性",width:80},{field:"customerLevel",title:"客户级别",width:80},{field:"headquarterCode",title:"总部编码",width:120},{field:"headquarterName",title:"总部名称",width:300},{field:"productMix",title:"产品组合",width:300},{field:"product",title:"产品",width:150}],e||["达成率","产品增长率","项目达成金额","折扣系数"])}return q((()=>u(this,null,(function*(){const e=yield S(t.planId||0);e.data?o(e.data.dimensionFactor):o()})))),(e,o)=>{const d=E,r=H,n=$,i=Y,u=Q,s=c("vxe-button"),p=c("vxe-grid"),m=c("vxe-modal");return f(),g(k,null,[b(p,M(L(C(l))),{search_customerCategory:V((({data:e})=>[b(d,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t},null,8,["modelValue","onUpdate:modelValue"])])),search_customerLevel:V((({data:e})=>[b(r,{modelValue:e.customerLevel,"onUpdate:modelValue":t=>e.customerLevel=t},null,8,["modelValue","onUpdate:modelValue"])])),search_headquarter:V((({data:e})=>[b(n,{modelValue:e.headquarter,"onUpdate:modelValue":t=>e.headquarter=t},null,8,["modelValue","onUpdate:modelValue"])])),search_productMix:V((({data:e})=>[b(i,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t},null,8,["modelValue","onUpdate:modelValue"])])),search_product:V((({data:e})=>[b(u,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t},null,8,["modelValue","onUpdate:modelValue"])])),search_operation:V((()=>[b(s,{status:"primary",content:"搜索"})])),toolbar_buttons:V((()=>[t.disabled?_("v-if",!0):(f(),h(s,{key:0,onClick:o[0]||(o[0]=e=>C(a).showRuleCreator=!0),status:"primary"},{default:V((()=>[w(" 添加折扣系数 ")])),_:1})),t.disabled?_("v-if",!0):(f(),h(s,{key:1,status:"danger",onClick:o[1]||(o[1]=e=>C(B)("勾选删除"))},{default:V((()=>[w(" 删除数据 ")])),_:1})),b(s,{onClick:o[2]||(o[2]=e=>C(B)("下载表格数据，全字段"))},{default:V((()=>[w("下载数据")])),_:1}),t.disabled?_("v-if",!0):(f(),h(s,{key:2,onClick:o[3]||(o[3]=e=>C(B)("全字段模板"))},{default:V((()=>[w("导入数据")])),_:1}))])),_:1},16),b(m,{modelValue:C(a).showRuleCreator,"onUpdate:modelValue":o[4]||(o[4]=e=>C(a).showRuleCreator=e),title:"添加折扣系数",width:"90%",height:"80%",resize:"","destroy-on-close":""},{default:V((()=>[b(Z,{"after-save-success":()=>{C(a).showRuleCreator=!1}},null,8,["after-save-success"])])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-5e7c2df2"],["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/DiscountFactorListView.vue"]]),te=R("div",{style:{color:"silver"}},[R("span",null,"此段文字仅需求说明，非页面元素。"),R("br"),R("span",null," 页面对于区间是否有交叉不做校验。如果有多个交叉的错误数据，以匹配的第一个作为计算值。 "),R("br"),R("span",null,"都输入小数，不用转换百分比；小数4位。"),R("br"),R("span",null,"下限不填写默认为无穷小，上限不填默认为无穷大；"),R("br"),R("span",null,"计算为 大于等于下限，小于上限；"),R("br"),R("span",null,"如果公式中有使用到，折扣比例或者存量/增量支付比例取不到，则返利金额=空。")],-1),ae=x(p({__name:"DiscountRatioCreatorView",props:{afterSaveSuccess:{type:Function,required:!0}},setup(e){const t=e,a=m(),l=m(),o=y({customerCategory:[],productMix:[],customerLevel:[],headquarter:[],product:[],dimension:[]}),d={},r=y(i(n({},P("ruleGrid")),{data:[],pagerConfig:void 0,columns:[],editConfig:{trigger:"click",mode:"row",showStatus:!0}})),s=()=>u(this,null,(function*(){var e;null==(e=l.value)||e.insertAt({},-1)})),p=()=>u(this,null,(function*(){var e;null==(e=l.value)||e.removeCheckboxRow()}));return v(o.dimension,(()=>{r.columns=X([{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"}],o.dimension)})),(e,n)=>{const i=E,u=c("vxe-form-item"),m=Y,h=H,_=$,x=Q,y=c("vxe-checkbox"),v=c("vxe-checkbox-group"),R=c("vxe-form"),q=c("vxe-button"),M=c("vxe-grid");return f(),g(k,null,[b(R,{"title-align":"right","title-width":"180",data:C(o),rules:d,ref_key:"xForm",ref:a},{default:V((()=>[b(u,{field:"customerCategory",title:"KA属性",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(i,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"productMix",title:"产品组合",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(m,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"customerLevel",title:"客户级别",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(h,{modelValue:e.customerLevel,"onUpdate:modelValue":t=>e.customerLevel=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"headquarter",title:"总部",span:11,"title-prefix":{content:"根据方案主体中的Q筛选下拉框内容；多选后生成笛卡尔积；"}},{default:V((({data:e})=>[b(_,{modelValue:e.headquarter,"onUpdate:modelValue":t=>e.headquarter=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{field:"product",title:"产品",span:11,"title-prefix":{content:"根据所选产品组中的产品；可多选"}},{default:V((({data:e})=>[b(x,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(u,{"title-width":"100",field:"dimension",title:"维度",span:24},{default:V((({data:e})=>[b(v,{modelValue:e.dimension,"onUpdate:modelValue":t=>e.dimension=t},{default:V((()=>[b(y,{label:"协议目标金额",content:"协议目标金额"}),b(y,{label:"达成率",content:"达成率"}),b(y,{label:"产品增长率",content:"产品增长率"}),b(y,{label:"产品贡献率",content:"产品贡献率"}),b(y,{label:"项目达成金额",content:"项目达成金额"}),b(y,{label:"增长金额",content:"增长金额"}),b(y,{label:"存量/增量支付比例",content:"存量/增量支付比例"}),b(y,{label:"折扣比例",content:"折扣比例"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),te,b(M,U({ref_key:"xGrid",ref:l},C(r)),{toolbar_buttons:V((()=>[b(q,{onClick:s,status:"primary"},{default:V((()=>[w("添加行")])),_:1}),b(q,{onClick:p,status:"primary"},{default:V((()=>[w("删除行")])),_:1})])),_:1},16),b(R,{"title-align":"right","title-width":"180",data:C(o),rules:d,ref_key:"xForm",ref:a},{default:V((()=>[b(u,{align:"center","title-align":"left",span:24},{default:V((()=>[b(q,{status:"primary",onClick:n[0]||(n[0]=e=>C(B)("需校验KA属性+客户级别+总部+产品组合+产品是否存在，如有则添加失败，给出提示").then((()=>{t.afterSaveSuccess()})))},{default:V((()=>[w(" 确认添加 ")])),_:1})])),_:1})])),_:1},8,["data"])],64)}}}),[["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/DiscountRatioCreatorView.vue"]]),le=x(p({__name:"DiscountRatioListView",props:{disabled:{type:Boolean,required:!1},planId:{type:String,required:!1}},setup(e){const t=e,a=y({showRatioCreator:!1}),l=y(i(n({},P("xGrid",(e=>N(n({planId:t.planId},e))))),{formConfig:{items:[{folding:!1,slots:{default:"search_customerCategory"}},{folding:!1,slots:{default:"search_customerLevel"}},{folding:!1,slots:{default:"search_headquarter"}},{folding:!1,slots:{default:"search_productMix"}},{folding:!0,slots:{default:"search_product"}},{collapseNode:!0,itemRender:{},slots:{default:"search_operation"}}]},columns:[]}));function o(e){l.columns=X([{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"},{field:"customerCategory",title:"KA属性",width:80},{field:"customerLevel",title:"客户级别",width:80},{field:"headquarterCode",title:"总部编码",width:120},{field:"headquarterName",title:"总部名称",width:300},{field:"productMix",title:"产品组合",width:300},{field:"product",title:"产品",width:150}],e||["达成率","产品增长率","产品贡献率","项目达成金额","增长金额","存量/增量支付比例","折扣比例"])}return q((()=>u(this,null,(function*(){const e=yield S(t.planId||0);e.data?o(e.data.dimensionRatio):o()})))),(e,o)=>{const d=E,r=H,n=$,i=Y,u=Q,s=c("vxe-button"),p=c("vxe-grid"),m=c("vxe-modal");return f(),g(k,null,[b(p,M(L(C(l))),{search_customerCategory:V((({data:e})=>[b(d,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t},null,8,["modelValue","onUpdate:modelValue"])])),search_customerLevel:V((({data:e})=>[b(r,{modelValue:e.customerLevel,"onUpdate:modelValue":t=>e.customerLevel=t},null,8,["modelValue","onUpdate:modelValue"])])),search_headquarter:V((({data:e})=>[b(n,{modelValue:e.headquarter,"onUpdate:modelValue":t=>e.headquarter=t},null,8,["modelValue","onUpdate:modelValue"])])),search_productMix:V((({data:e})=>[b(i,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t},null,8,["modelValue","onUpdate:modelValue"])])),search_product:V((({data:e})=>[b(u,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t},null,8,["modelValue","onUpdate:modelValue"])])),search_operation:V((()=>[b(s,{status:"primary",content:"搜索"})])),toolbar_buttons:V((()=>[t.disabled?_("v-if",!0):(f(),h(s,{key:0,onClick:o[0]||(o[0]=e=>C(a).showRatioCreator=!0),status:"primary"},{default:V((()=>[w(" 添加折扣比例 ")])),_:1})),t.disabled?_("v-if",!0):(f(),h(s,{key:1,status:"danger",onClick:o[1]||(o[1]=e=>C(B)("勾选删除"))},{default:V((()=>[w(" 删除数据 ")])),_:1})),b(s,{onClick:o[2]||(o[2]=e=>C(B)("下载表格数据"))},{default:V((()=>[w("下载数据")])),_:1}),t.disabled?_("v-if",!0):(f(),h(s,{key:2},{default:V((()=>[w("导入数据")])),_:1}))])),_:1},16),b(m,{modelValue:C(a).showRatioCreator,"onUpdate:modelValue":o[3]||(o[3]=e=>C(a).showRatioCreator=e),title:"添加折扣比例",width:"90%",resize:"","destroy-on-close":""},{default:V((()=>[b(ae,{"after-save-success":()=>{C(a).showRatioCreator=!1}},null,8,["after-save-success"])])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-08f45383"],["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/DiscountRatioListView.vue"]]),oe=x(p({__name:"CapFormView",props:{disabled:{type:Boolean,required:!1},planId:{type:String,required:!1}},setup(e){const t=e,a=y({showRuleCreator:!1}),l=y({customerCategory:[],productMix:[],customerLevel:[],headquarter:[],product:[]}),o=y(i(n({},P("ruleGrid",(e=>K(n({planId:t.planId},e))))),{formConfig:{items:[{folding:!1,slots:{default:"search_customerCategory"}},{folding:!1,slots:{default:"search_productMix"}},{folding:!1,slots:{default:"search_product"}},{itemRender:{},slots:{default:"search_operation"}}]},columns:[{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"},{field:"customerCategory",title:"KA属性",width:80},{field:"productMix",title:"产品组合",width:300},{field:"product",title:"产品",width:150},{field:"growthRateCap",title:"增长率封顶值",width:150},{field:"achieveRateCap",title:"达成率封顶值",width:150}]}));return(e,d)=>{const r=E,n=Y,i=Q,u=c("vxe-button"),s=c("vxe-grid"),p=c("vxe-form-item"),m=c("vxe-input"),x=c("vxe-form"),y=c("vxe-modal");return f(),g(k,null,[b(s,M(L(C(o))),{search_customerCategory:V((({data:e})=>[b(r,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t},null,8,["modelValue","onUpdate:modelValue"])])),search_productMix:V((({data:e})=>[b(n,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t},null,8,["modelValue","onUpdate:modelValue"])])),search_product:V((({data:e})=>[b(i,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t},null,8,["modelValue","onUpdate:modelValue"])])),search_operation:V((()=>[b(u,{status:"primary",content:"搜索"})])),toolbar_buttons:V((()=>[t.disabled?_("v-if",!0):(f(),h(u,{key:0,onClick:d[0]||(d[0]=e=>C(a).showRuleCreator=!0),status:"primary"},{default:V((()=>[w(" 添加封顶值 ")])),_:1})),t.disabled?_("v-if",!0):(f(),h(u,{key:1,status:"danger",onClick:d[1]||(d[1]=e=>C(B)("勾选删除"))},{default:V((()=>[w(" 删除数据 ")])),_:1})),b(u,{onClick:d[2]||(d[2]=e=>C(B)("下载表格数据，全字段"))},{default:V((()=>[w("下载数据")])),_:1})])),_:1},16),b(y,{modelValue:C(a).showRuleCreator,"onUpdate:modelValue":d[4]||(d[4]=e=>C(a).showRuleCreator=e),title:"添加封顶值",width:"90%",resize:"","destroy-on-close":""},{default:V((()=>[b(x,{"title-align":"right","title-width":"180",ref:"xForm",data:C(l)},{default:V((()=>[b(p,{field:"customerCategory",title:"KA属性",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(r,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(p,{field:"productMix",title:"产品组合",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(n,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(p,{field:"product",title:"产品",span:11,"title-prefix":{content:"根据所选产品组中的产品；可多选"}},{default:V((({data:e})=>[b(i,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(p,{field:"growthRateCap",title:"增长率封顶值",span:11,"title-prefix":{content:"小数，不是百分比"}},{default:V((({data:e})=>[b(m,{modelValue:e.growthRateCap,"onUpdate:modelValue":t=>e.growthRateCap=t,type:"number"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(p,{field:"achieveRateCap",title:"达成率封顶值",span:11,"title-prefix":{content:"小数，不是百分比"}},{default:V((({data:e})=>[b(m,{modelValue:e.achieveRateCap,"onUpdate:modelValue":t=>e.achieveRateCap=t,type:"number"},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),b(x,{"title-align":"right","title-width":"180",ref:"xForm"},{default:V((()=>[b(p,{align:"center","title-align":"left",span:24},{default:V((()=>[b(u,{status:"primary",onClick:d[3]||(d[3]=e=>C(B)("需校验KA属性+产品组合+产品是否存在，如有则添加失败，给出提示").then((()=>{C(a).showRuleCreator=!1})))},{default:V((()=>[w(" 确认添加 ")])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-96552462"],["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/CapFormView.vue"]]),de=x(p({__name:"AchieveBaseView",props:{disabled:{type:Boolean,required:!1},planId:{type:String,required:!1}},setup(e){const t=e,a=y(i(n({},P("capGrid",(e=>G(i(n({},e),{planId:t.planId}))))),{formConfig:{items:[{folding:!1,slots:{default:"search_quarter"}},{folding:!1,slots:{default:"search_headquarter"}},{folding:!1,slots:{default:"search_productMix"}},{folding:!0,slots:{default:"search_product"}},{collapseNode:!0,itemRender:{},slots:{default:"search_operation"}}]},columns:[{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"},{field:"quarter",title:"季度",width:80},{field:"headquarterCode",title:"总部编码",width:120},{field:"headquarterName",title:"总部名称",width:300},{field:"productMix",title:"产品组合",width:300},{field:"productCode",title:"产品编码",width:150},{field:"productName",title:"产品名称",width:300},{field:"achieveAmount",title:"项目达成基数",width:200}]}));return(e,l)=>{const o=O,d=$,r=Y,n=Q,i=c("vxe-button"),u=c("vxe-grid");return f(),h(u,M(L(C(a))),{search_quarter:V((({data:e})=>[b(o,{modelValue:e.quarter,"onUpdate:modelValue":t=>e.quarter=t},null,8,["modelValue","onUpdate:modelValue"])])),search_headquarter:V((({data:e})=>[b(d,{modelValue:e.headquarter,"onUpdate:modelValue":t=>e.headquarter=t},null,8,["modelValue","onUpdate:modelValue"])])),search_productMix:V((({data:e})=>[b(r,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t},null,8,["modelValue","onUpdate:modelValue"])])),search_product:V((({data:e})=>[b(n,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t},null,8,["modelValue","onUpdate:modelValue"])])),search_operation:V((()=>[b(i,{status:"primary",content:"搜索"})])),toolbar_buttons:V((()=>[t.disabled?_("v-if",!0):(f(),h(i,{key:0,onClick:l[0]||(l[0]=e=>C(B)("导入字段：季度(Y)、总部编码(Y)、产品组合(Y)、SKU编码、项目达成基数(Y)\n      唯一性校验：季度+总部编码+产品组合+产品编码(如有)\n      季度必须是方案的季度，且总部、产品组合都是季度中有效的"))},{default:V((()=>[w(" 导入数据 ")])),_:1})),t.disabled?_("v-if",!0):(f(),h(i,{key:1,status:"danger"},{default:V((()=>[w("删除数据")])),_:1})),b(i,null,{default:V((()=>[w("下载数据")])),_:1})])),_:1},16)}}}),[["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/AchieveBaseView.vue"]]),re={id:"formulaParams"},ne=x(p({__name:"FormulaView",props:{disabled:{type:Boolean,required:!1},planId:{type:String,required:!1}},setup(e){const t=e,a=y({showRuleCreator:!1}),l=m(),o=m();function d(e){var t;r.formulaTxt+=`[${e.$button.props.content}]`,null==(t=o.value)||t.focus()}const r=y({customerCategory:[],productMix:[],product:[],formulaTxt:""}),u=y(i(n({},P("ruleGrid",(e=>K(n({planId:t.planId},e))))),{formConfig:{items:[{folding:!1,slots:{default:"search_customerCategory"}},{folding:!1,slots:{default:"search_productMix"}},{folding:!1,slots:{default:"search_product"}},{itemRender:{},slots:{default:"search_operation"}}]},columns:[{field:"checkbox",type:"checkbox",width:50,align:"center",fixed:"left"},{field:"customerCategory",title:"KA属性",width:80},{field:"productMix",title:"产品组合",width:300},{field:"product",title:"产品",width:150},{field:"rebateCalFormula",title:"返利金额计算公式",width:300},{field:"adjustCalFormula",title:"调整后达成金额计算公式",width:300},{field:"taxRate",title:"税率",width:150}]}));return(e,n)=>{const i=E,s=Y,p=Q,m=c("vxe-button"),x=c("vxe-grid"),y=c("vxe-form-item"),v=c("vxe-textarea"),U=c("vxe-form"),q=c("vxe-modal");return f(),g(k,null,[b(x,M(L(C(u))),{search_customerCategory:V((({data:e})=>[b(i,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t},null,8,["modelValue","onUpdate:modelValue"])])),search_productMix:V((({data:e})=>[b(s,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t},null,8,["modelValue","onUpdate:modelValue"])])),search_product:V((({data:e})=>[b(p,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t},null,8,["modelValue","onUpdate:modelValue"])])),search_operation:V((()=>[b(m,{status:"primary",content:"搜索"})])),toolbar_buttons:V((()=>[t.disabled?_("v-if",!0):(f(),h(m,{key:0,onClick:n[0]||(n[0]=e=>C(a).showRuleCreator=!0),status:"primary"},{default:V((()=>[w(" 添加计算公式 ")])),_:1})),t.disabled?_("v-if",!0):(f(),h(m,{key:1,status:"danger",onClick:n[1]||(n[1]=e=>C(B)("勾选删除"))},{default:V((()=>[w(" 删除数据 ")])),_:1})),b(m,{onClick:n[2]||(n[2]=e=>C(B)("下载表格数据，全字段"))},{default:V((()=>[w("下载数据")])),_:1})])),_:1},16),b(q,{modelValue:C(a).showRuleCreator,"onUpdate:modelValue":n[4]||(n[4]=e=>C(a).showRuleCreator=e),title:"添加公式",width:"90%",height:"80%",resize:"","destroy-on-close":""},{default:V((()=>[b(U,{"title-align":"right","title-width":"180",ref_key:"xForm",ref:l,data:C(r)},{default:V((()=>[b(y,{field:"customerCategory",title:"KA属性",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(i,{modelValue:e.customerCategory,"onUpdate:modelValue":t=>e.customerCategory=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(y,{field:"productMix",title:"产品组合",span:11,"title-prefix":{content:"多选后生成笛卡尔积"}},{default:V((({data:e})=>[b(s,{modelValue:e.productMix,"onUpdate:modelValue":t=>e.productMix=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(y,{field:"product",title:"产品",span:11,"title-prefix":{content:"根据所选产品组中的产品；可多选"}},{default:V((({data:e})=>[b(p,{modelValue:e.product,"onUpdate:modelValue":t=>e.product=t,multiple:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(y,{field:"formulaTxt",title:"返利金额计算公式",span:22},{default:V((({data:e})=>[b(v,{ref_key:"ta",ref:o,modelValue:e.formulaTxt,"onUpdate:modelValue":t=>e.formulaTxt=t,rows:"3",disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),t.disabled?_("v-if",!0):(f(),h(y,{key:0,field:"parameters",title:"返利金额计算公式参数",span:24,"title-prefix":{content:"a)协议目标金额：方案中的产品组合取汇总到总部层级对应的协议目标金额\n        b)项目达成金额：根据规则配置中的产品取汇总到总部层级对应的项目达成金额即总销量；如果未单独配置产品则取方案中的产品组合取汇总到总部层级对应的项目达成金额即总销量\n        c)达成率=项目达成金额/协议指标金额\n        d)增长率=项目达成金额/上一年度对应该季度（年度）（为用户上传的项目达成基数）项目达成金额-1\n        e)增长金额=当季度（年度）项目达成金额 - 上一年度对应该季度（年度）项目达成金额（为用户上传的项目达成基数）\n        f)产品贡献率=当季度（年度）某个产品项目达成金额/当季度（年度）该产品所在产品组合达成金额\n        g)折扣比例=规则中配置的折扣比例\n        h)折扣系数=规则中配置的折扣系数\n        i)项目达成基数=用户上传数据\n        j)存量支付比例=规则中配置的存量支付比例\n        k)增量支付比例=规则中配置的增量支付比例"}},{default:V((()=>[R("div",re,[b(m,{status:"primary",onClick:d,content:"协议目标金额"}),b(m,{status:"primary",onClick:d,content:"项目达成金额"}),b(m,{status:"primary",onClick:d,content:"项目达成基数"}),b(m,{status:"primary",onClick:d,content:"达成率"}),b(m,{status:"primary",onClick:d,content:"产品增长率"}),b(m,{status:"primary",onClick:d,content:"产品贡献率"}),b(m,{status:"primary",onClick:d,content:"存量支付比例"}),b(m,{status:"primary",onClick:d,content:"增量支付比例"}),b(m,{status:"primary",onClick:d,content:"折扣比例"}),b(m,{status:"primary",onClick:d,content:"折扣系数"}),b(m,{status:"primary",onClick:d,content:"达成率封顶值"}),b(m,{status:"primary",onClick:d,content:"产品增长率封顶值"})])])),_:1})),b(y,{title:"调整后产品达成金额计算公式",span:22,"title-prefix":{content:"产品组合实际达成率 > 封顶值\n调整后产品达成金额 =（产品实际达成金额/产品组实际达成率）*封顶值\n产品组合实际达成率 <= 封顶值\n调整后产品达成金额 = 产品实际达成金额\n\n返利金额的计算公式，使用的是调整后的达成金额和达成率和增长率\n"}},{default:V((({data:e})=>[b(v,{rows:"2",modelValue:e.xx,"onUpdate:modelValue":t=>e.xx=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),b(y,{title:"税率",span:22},{default:V((({data:e})=>[b(v,{rows:"1",modelValue:e.xx,"onUpdate:modelValue":t=>e.xx=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),b(U,{"title-align":"right","title-width":"180",ref_key:"xForm",ref:l},{default:V((()=>[b(y,{align:"center","title-align":"left",span:24},{default:V((()=>[b(m,{status:"primary",onClick:n[3]||(n[3]=e=>C(B)("需校验KA属性+产品组合+产品是否存在，如有则添加失败，给出提示").then((()=>{C(a).showRuleCreator=!1})))},{default:V((()=>[w(" 确认添加 ")])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-0e2a22c5"],["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/components/FormulaView.vue"]]),ie=x(p({__name:"RebatePlanCreatorView",setup(e){const t=D(),a=F(),l=t.params.planId instanceof Array?t.params.planId[0]:t.params.planId,o=m("1"),d=y({mainData:{},discountFactorData:[],discountRatioData:[],achieveBase:[],capData:{},formula:""});return q((()=>u(this,null,(function*(){if(l){const e=yield S(l),{capDetails:t,achieveBase:a,discountFactorDetails:o,discountRatioDetails:r,formulaText:n}=e.data;d.mainData=e.data,d.mainData.customerCategory=e.data.customerCategory.split(","),d.mainData.productMix=e.data.productMix.split(","),d.capData=t,d.achieveBase=a,d.discountFactorData=o,d.discountRatioData=r,d.formula=n}else d.mainData={planType:"零售KA返利",year:"2022",planName:"",quarter:"2022Q1",dimension:[]}})))),(e,t)=>{const r=I,n=s,i=j,u=c("vxe-button"),p=c("vxe-form-item"),m=c("vxe-form"),_=c("page-container");return f(),h(_,null,{default:V((()=>[b(i,{activeKey:C(o),"onUpdate:activeKey":t[0]||(t[0]=e=>T(o)?o.value=e:null),type:"card"},{default:V((()=>[b(r,{key:"1",tab:"方案主体"},{default:V((()=>[b(W,{formData:C(d).mainData},null,8,["formData"])])),_:1}),b(r,{key:"2",tab:"折扣系数"},{default:V((()=>[b(ee,{"plan-id":C(l)},null,8,["plan-id"])])),_:1}),b(r,{key:"3",tab:"折扣比例"},{default:V((()=>[b(le,{"plan-id":C(l)},null,8,["plan-id"])])),_:1}),b(r,{key:"4",tab:"封顶值"},{default:V((()=>[b(oe,{data:C(d).capData},null,8,["data"])])),_:1}),b(r,{key:"5",tab:"达成基数"},{default:V((()=>[b(de,{"plan-id":C(l)},null,8,["plan-id"])])),_:1}),b(r,{key:"6",tab:"公式"},{default:V((()=>[b(ne,{formulaTxt:C(d).formula},null,8,["formulaTxt"])])),_:1}),b(r,{key:"7",tab:"附件"},{default:V((()=>[b(n,{"enable-insert":!0,"enable-remove":!0})])),_:1})])),_:1},8,["activeKey"]),b(m,{style:{"margin-top":"20px"}},{default:V((()=>[b(p,{align:"center","title-align":"left",span:24},{default:V((()=>[b(u,{status:"primary",content:"发布方案",onClick:t[1]||(t[1]=e=>C(B)("没有审批，发布后状态变为生效。\n            系统需校验：总部名称+产品组合+返利方案类型+开始日期+结束日期是唯一不能重复，即：同一个总部，在同一时间段内，同一产品组合的同一零售返利类型只能有一个方案，不能有多个。"))}),b(u,{status:"primary",content:"保存草稿"}),b(u,{onClick:t[2]||(t[2]=e=>C(A)(C(a),"plan-retail-rebate")),content:"回到列表"})])),_:1})])),_:1})])),_:1})}}}),[["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/retail-rebate-plan/RebatePlanCreatorView.vue"]]);export{ie as default};

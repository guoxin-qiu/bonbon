var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,r=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,n=(e,t)=>{for(var l in t||(t={}))i.call(t,l)&&r(e,l,t[l]);if(a)for(var l of a(t))d.call(t,l)&&r(e,l,t[l]);return e},o=(e,a)=>t(e,l(a));import{_ as u}from"./index.a8d86bf2.js";import{_ as s}from"./index.62bfc2e0.js";import{d as f,bn as m,aQ as c,r as p,az as y,a9 as h,bj as w,aV as b,aW as v,aS as k,a as _,aX as V,aR as C,ca as P,ay as D,ac as g,cj as x,ck as S,a_ as U,bk as T,bR as O,cl as j,bK as q,a$ as I}from"./index.44eff430.js";import{g as N,a as R}from"./vxeTableHelper.6baae079.js";import{i as F}from"./temporary-data.4dfd9cc4.js";import{a as Q}from"./c-plan-inventory.service.aeccc628.js";import{r as A}from"./routerHelper.692f5c09.js";import{Q as E}from"./vue-quill.snow.40f2bfe1.js";import"./master-data.service.95993c0c.js";const K=I(f({__name:"FactoryPriceReduceCreator",setup(e){const t=m(),l=c(),a="pair"===t.params.type||t.params.type instanceof Array&&"pair"===t.params.type[0],i=a?"中标价&出厂价同时下调":"单出厂价下调",d=p("1"),r=p(),f=y({formData:{chineseName:`${i}库存补偿方案`,cPlanInventoryScenario:i,cPlanType:"库存补偿"},formRules:{chineseName:[{required:!0}],cPlanInventoryScenario:[{required:!0}],cPlanType:[{required:!0}]},showPlanCreator:!1,showStockDateSelector:!1}),I=y({formData:{subType:"",province:[],sku:"",skuCoefficient:1,basePriceNew:void 0,basePriceOld:void 0,estimateStockQuantity:void 0},formRules:{subType:[{required:!0}],province:[{required:!0}],sku:[{required:!0}],skuCoefficient:[{required:!0}],basePriceNew:[{required:!0}],basePriceOld:[{required:!0}],estimateStockQuantity:[{required:!0}],inventoryDate:[{required:!0}],priceReductionDate:[{required:!0}],unitPrice:[{required:!0}],estimateTotalAmount:[{required:!0}]},showStockDateSelector:!1}),K=h((()=>(I.formData.basePriceOld||0)-(I.formData.basePriceNew||0))),z=h((()=>(I.formData.estimateStockQuantity||0)*K.value*(I.formData.skuCoefficient||0))),G=y(o(n({},N("importerDetailGrid",(e=>Q(o(n({},e),{planId:2,type:"进口商"}))))),{columns:[{field:"type",title:"补偿对象",width:100},{field:"skuCode",title:"产品编码",width:100},{field:"skuName",title:"产品名称",width:200},{field:"skuCoefficient",title:"产品预估系数",width:120},{field:"basePriceOld",title:"旧CIF价",width:120},{field:"basePriceNew",title:"新CIF价",width:120},{field:"unitPrice",title:"补偿单价",width:100},{field:"inventoryDate",title:"盘库日期",width:100},{field:"priceReductionDate",title:"降价日期",width:100},{field:"estimateStockQuantity",title:"预估库存数量",width:120},{field:"estimateTotalAmount",title:"预估补偿金额",width:120},{field:"remark",title:"备注",width:100},{title:"操作",align:"center",fixed:"right",width:150,slots:{default:"operations"}}]})),H=y(o(n({},N("dealerDetailGrid",(e=>Q(o(n({},e),{planId:2,type:"渠道"}))))),{columns:[{field:"type",title:"补偿对象",width:100},{field:"province",title:"省份",width:100},{field:"skuCode",title:"产品编码",width:100},{field:"skuName",title:"产品名称",width:200},{field:"skuCoefficient",title:"产品预估系数",width:120},{field:"basePriceOld",title:"旧一级商底价",width:120},{field:"basePriceNew",title:"新一级商底价",width:120},{field:"unitPrice",title:"补偿单价",width:100},{field:"inventoryDate",title:"盘库日期",width:100},{field:"priceReductionDate",title:"降价日期",width:100},{field:"estimateStockQuantity",title:"预估库存数量",width:120},{field:"estimateTotalAmount",title:"预估补偿金额",width:120},{field:"remark",title:"备注",width:100},{title:"操作",align:"center",fixed:"right",width:150,slots:{default:"operations"}}]})),$=y(o(n({},N("dealerDetailGrid",(e=>Q(o(n({},e),{planId:2,type:"终端"}))))),{columns:[{field:"type",title:"补偿对象",width:100},{field:"inventoryDate",title:"降价日期",width:120},{field:"province",title:"省份",width:100},{field:"city",title:"城市",width:100},{field:"skuCode",title:"产品编码",width:100},{field:"skuName",title:"产品名称",width:200},{field:"skuCoefficient",title:"产品预估系数",width:120},{field:"basePriceOld",title:"旧一级商底价",width:120},{field:"basePriceNew",title:"新一级商底价",width:120},{field:"unitPrice",title:"补偿单价",width:100},{field:"estimateStockQuantity",title:"预估库存数量",width:120},{field:"estimateTotalAmount",title:"预估补偿金额",width:120},{field:"remark",title:"备注",width:100},{title:"操作",align:"center",fixed:"right",width:150,slots:{default:"operations"}}]}));function B(){var e;null==(e=r.value)||e.validate((e=>{void 0===e&&R("提交成功后，进入审批。")}))}return(e,t)=>{const i=w("vxe-option"),n=w("vxe-select"),o=w("vxe-form-item"),m=w("vxe-input"),c=w("vxe-form"),p=w("vxe-button"),y=w("vxe-grid"),h=j,N=q,Q=s,W=u,X=w("vxe-checkbox"),J=w("vxe-textarea"),L=w("vxe-modal"),M=w("page-container");return b(),v(M,null,{default:k((()=>[_(c,{"title-align":"right","title-width":"100",data:D(f).formData,rules:D(f).formRules,ref_key:"xForm",ref:r},{default:k((()=>[V(' <vxe-form-item\n        title-width="180"\n        field="cPlanType"\n        title="补偿方案类型"\n        :span="12"\n        :item-render="{}"\n      >\n        <template #default="{ data }">\n          <vxe-select v-model="data.cPlanType" disabled placeholder="">\n            <vxe-option\n              v-for="item in [{ value: \'库存补偿\', label: \'库存补偿\' }]"\n              :key="item.value"\n              :value="item.value"\n              :label="item.label"\n            ></vxe-option>\n          </vxe-select>\n        </template>\n      </vxe-form-item> '),_(o,{"title-width":"180",field:"cPlanInventoryScenario",title:"降价类型",span:12,"item-render":{}},{default:k((({data:e})=>[_(n,{modelValue:e.cPlanInventoryScenario,"onUpdate:modelValue":t=>e.cPlanInventoryScenario=t,transfer:"",disabled:"",placeholder:""},{default:k((()=>[(b(!0),C(g,null,P(D(F),(e=>(b(),v(i,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),_(o,{"title-width":"180",field:"chineseName",title:"方案名称",span:24,"item-render":{}},{default:k((({data:e})=>[_(m,{modelValue:e.chineseName,"onUpdate:modelValue":t=>e.chineseName=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),_(o,{"title-width":"180",field:"remark",title:"方案概要",span:24,"item-render":{}},{default:k((({data:e})=>[_(D(E),{content:e.remark,toolbar:"full"},null,8,["content"])])),_:1})])),_:1},8,["data","rules"]),_(N,{activeKey:D(d),"onUpdate:activeKey":t[11]||(t[11]=e=>O(d)?d.value=e:null),type:"card",style:{"margin-top":"10px"}},{default:k((()=>[_(h,{key:"2",tab:"进口商"},{default:k((()=>[_(y,x(S(D(G))),{toolbar_buttons:k((()=>[_(p,{status:"primary",onClick:t[0]||(t[0]=()=>{D(f).showPlanCreator=!0,D(I).formData.subType="进口商"})},{default:k((()=>[U(" 添加 ")])),_:1}),T("i",{class:"vxe-icon-question-circle-fill",style:{"margin-left":"10px",cursor:"pointer"},onClick:t[1]||(t[1]=e=>D(R)("列表分页显示，可以实时的存储数据库。\n            补偿对象+产品编码+降价日期不能重复。"))})])),operations:k((()=>[_(p,{status:"primary",onClick:t[2]||(t[2]=e=>D(R)("任意编辑"))},{default:k((()=>[U("编辑")])),_:1}),_(p,{status:"danger",onClick:t[3]||(t[3]=e=>D(R)("直接删除"))},{default:k((()=>[U("删除")])),_:1})])),_:1},16)])),_:1}),_(h,{key:"1",tab:"渠道"},{default:k((()=>[_(y,x(S(D(H))),{toolbar_buttons:k((()=>[_(p,{status:"primary",onClick:t[4]||(t[4]=()=>{D(f).showPlanCreator=!0,D(I).formData.subType="渠道"})},{default:k((()=>[U(" 添加 ")])),_:1}),T("i",{class:"vxe-icon-question-circle-fill",style:{"margin-left":"10px",cursor:"pointer"},onClick:t[5]||(t[5]=e=>D(R)("列表分页显示，可以实时的存储数据库。\n            补偿对象+省份+产品编码+降价日期不能重复。"))})])),operations:k((()=>[_(p,{status:"primary",onClick:t[6]||(t[6]=e=>D(R)("任意编辑"))},{default:k((()=>[U("编辑")])),_:1}),_(p,{status:"danger",onClick:t[7]||(t[7]=e=>D(R)("直接删除"))},{default:k((()=>[U("删除")])),_:1})])),_:1},16)])),_:1}),D(a)?(b(),v(h,{key:"3",tab:"终端"},{default:k((()=>[_(y,x(S(D($))),{toolbar_buttons:k((()=>[_(p,{status:"primary",onClick:t[8]||(t[8]=()=>{D(f).showPlanCreator=!0,D(I).formData.subType="终端"})},{default:k((()=>[U(" 添加 ")])),_:1})])),operations:k((()=>[_(p,{status:"primary",onClick:t[9]||(t[9]=e=>D(R)("任意编辑"))},{default:k((()=>[U("编辑")])),_:1}),_(p,{status:"danger",onClick:t[10]||(t[10]=e=>D(R)("直接删除"))},{default:k((()=>[U("删除")])),_:1})])),_:1},16)])),_:1})):V("v-if",!0)])),_:1},8,["activeKey"]),_(c,{"title-align":"right","title-width":"100",data:D(f).formData,rules:D(f).formRules},{default:k((()=>[_(o,{align:"center","title-align":"left",span:24},{default:k((()=>[_(p,{type:"submit",status:"primary",onClick:B},{default:k((()=>[U("提交审批")])),_:1}),_(p,{type:"submit",status:"primary",onClick:t[12]||(t[12]=e=>D(R)("保存草稿数据，校验必填项"))},{default:k((()=>[U(" 保存草稿 ")])),_:1}),_(p,{onClick:t[13]||(t[13]=e=>D(A)(D(l),"c-plan-inventory"))},{default:k((()=>[U("回到列表")])),_:1})])),_:1})])),_:1},8,["data","rules"]),_(L,{modelValue:D(f).showPlanCreator,"onUpdate:modelValue":t[19]||(t[19]=e=>D(f).showPlanCreator=e),title:"添加补偿方案明细",width:"80%","min-width":"600","min-height":"300",resize:"","destroy-on-close":""},{default:k((()=>[_(c,{"title-align":"right","title-width":"100",data:D(I).formData,rules:D(I).formRules,onSubmit:t[18]||(t[18]=e=>D(f).showPlanCreator=!1)},{default:k((()=>[_(o,{field:"subType",title:"库存补偿对象","title-width":"150",span:12,"item-render":{}},{default:k((({data:e})=>[_(n,{transfer:"",disabled:"",modelValue:e.subType,"onUpdate:modelValue":t=>e.subType=t,options:[{value:"进口商",label:"进口商"},{value:"渠道",label:"渠道"},{value:"终端",label:"终端"}]},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),"进口商"!==D(I).formData.subType?(b(),v(o,{key:0,field:"province",title:"省份","title-width":"150",span:12,"item-render":{}},{default:k((({data:e})=>[_(Q,{type:"province",modelValue:e.province,"onUpdate:modelValue":t=>e.province=t,nationwide:"",multiple:"",onChange:t=>e.city=""},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})):V("v-if",!0),"终端"===D(I).formData.subType?(b(),v(o,{key:1,field:"city",title:"城市","title-width":"150","title-prefix":{content:"如果省份是全国或者多选，城市不可用"},span:12,"item-render":{}},{default:k((({data:e})=>[_(Q,{type:"city",modelValue:e.city,"onUpdate:modelValue":t=>e.city=t,multiple:"","province-id":e.province},null,8,["modelValue","onUpdate:modelValue","province-id"])])),_:1})):V("v-if",!0),_(o,{field:"sku",title:"产品","title-width":"150",span:12,"item-render":{},"title-prefix":{content:"不根据补偿对象筛选产品，显示全部产品即可；每次仅可选择一个产品"}},{default:k((({data:e})=>[_(W,{modelValue:e.sku,"onUpdate:modelValue":t=>e.sku=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),_(o,{field:"skuCoefficient",title:"产品预估系数","title-width":"150",span:12,"item-render":{}},{default:k((({data:e})=>[_(m,{type:"number",modelValue:e.skuCoefficient,"onUpdate:modelValue":t=>e.skuCoefficient=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),"终端"!==D(I).formData.subType?(b(),v(o,{key:2,field:"inventoryDate",title:"盘库日期","title-width":"150",span:12,"item-render":{}},{default:k((({data:e})=>[_(m,{type:"date",modelValue:e.inventoryDate,"onUpdate:modelValue":t=>e.inventoryDate=t,transfer:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1})):V("v-if",!0),_(o,{field:"priceReductionDate",title:"降价日期","title-width":"150",span:12,"item-render":{}},{default:k((({data:e})=>[_(m,{type:"date",modelValue:e.priceReductionDate,"onUpdate:modelValue":t=>e.priceReductionDate=t,transfer:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),_(o,{field:"basePriceOld",title:"进口商"===D(I).formData.subType?"旧CIF价":"旧一级商底价","title-width":"150",span:12,"title-prefix":{content:"根据省份+产品+降价日期，从一级商底价或CIF价匹配获取，降价日期所在的区段的上一个价格。"},"item-render":{}},{default:k((({data:e})=>[_(m,{type:"number",modelValue:e.basePriceOld,"onUpdate:modelValue":t=>e.basePriceOld=t,style:{width:"70%"}},null,8,["modelValue","onUpdate:modelValue"]),_(p,{style:{width:"20%"},onClick:t[14]||(t[14]=e=>D(R)("查询一级商底价或CIF价，选择后带回价格数字即可"))},{default:k((()=>[U(" 查询 ")])),_:1})])),_:1},8,["title"]),_(o,{field:"basePriceNew",title:"进口商"===D(I).formData.subType?"新CIF价":"新一级商底价","title-width":"150",span:12,"title-prefix":{content:"根据省份+产品+降价日期，从一级商底价或CIF价匹配获取，降价日期所在的区段的上一个价格。"},"item-render":{}},{default:k((({data:e})=>[_(m,{type:"number",modelValue:e.basePriceNew,"onUpdate:modelValue":t=>e.basePriceNew=t,style:{width:"70%"}},null,8,["modelValue","onUpdate:modelValue"]),_(p,{style:{width:"20%"},onClick:t[15]||(t[15]=e=>D(R)("查询一级商底价或CIF价，选择后带回价格数字即可"))},{default:k((()=>[U(" 查询 ")])),_:1})])),_:1},8,["title"]),_(o,{field:"unitPrice",title:"补偿单价","title-width":"150",span:12,"item-render":{}},{default:k((()=>[_(m,{type:"number",disabled:"","model-value":D(K)},null,8,["model-value"])])),_:1}),_(o,{field:"estimateStockQuantity",title:"预估库存数量","title-width":"150",span:12,"item-render":{}},{default:k((({data:e})=>[_(m,{type:"number",modelValue:e.estimateStockQuantity,"onUpdate:modelValue":t=>e.estimateStockQuantity=t,style:{width:"60%"}},null,8,["modelValue","onUpdate:modelValue"]),_(p,{style:{width:"30%"},onClick:t[16]||(t[16]=e=>D(I).showStockDateSelector=!0)},{default:k((()=>[U(" 预估库存 ")])),_:1})])),_:1}),_(o,{field:"estimateTotalAmount",title:"预估补偿金额","title-width":"150",span:12,"item-render":{}},{default:k((()=>[_(m,{type:"number","model-value":D(z),disabled:""},null,8,["model-value"])])),_:1}),_(o,{field:"isShowEstimate","title-width":"150",title:">",span:24,"title-prefix":{content:"勾选与否，预估数据都要存库。\n              商务和商务总监没有权限查看预估数据。\n              勾选此条件，则其他角色都可以在列表查看预估数据。\n              如果不勾选，则仅有数据团队可见。\n              "},"item-render":{}},{default:k((({data:e})=>[_(X,{modelValue:e.isShowEstimate,"onUpdate:modelValue":t=>e.isShowEstimate=t},{default:k((()=>[U(" 是否包含预估库存数量和预估补偿金额 ")])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),_(o,{field:"remark",title:"备注","title-width":"150",span:24,"item-render":{}},{default:k((({data:e})=>[_(J,{modelValue:e.remark,"onUpdate:modelValue":t=>e.remark=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),_(o,{align:"center","title-align":"left",span:24},{default:k((()=>[_(p,{status:"primary",onClick:t[17]||(t[17]=e=>D(R)("多选的省份或产品以笛卡尔积方式拆分保存。\n                    如果省份是全国，则不需要拆分。"))},{default:k((()=>[U(" 确认 ")])),_:1})])),_:1})])),_:1},8,["data","rules"])])),_:1},8,["modelValue"]),_(L,{modelValue:D(I).showStockDateSelector,"onUpdate:modelValue":t[24]||(t[24]=e=>D(I).showStockDateSelector=e),title:"预估库存","min-width":"600","min-height":"300",resize:"","destroy-on-close":""},{default:k((()=>["终端"!==D(I).formData.subType?(b(),v(c,{key:0,"title-align":"right","title-width":"100",onSubmit:t[21]||(t[21]=e=>D(f).showStockDateSelector=!1)},{default:k((()=>[_(o,{field:"stockDate",title:"库存日期","title-width":"150","item-render":{}},{default:k((()=>[_(m,{type:"date",transfer:"",clearable:""})])),_:1}),_(o,{align:"center","title-align":"left",span:24},{default:k((()=>[_(p,{status:"primary",onClick:t[20]||(t[20]=e=>D(R)("经销商预估逻辑：手动选择库存日期，取该日库存数量作为预估数量。渠道库存数为全部经销商、零售连锁总店、处方药店总库存减掉进口商该产品该日的库存数。\n              进口商预估逻辑：手动选择库存日期，取该日库存数量作为预估数量。。取数客户范围：该产品的进口商。"))},{default:k((()=>[U(" 计算预估库存量 ")])),_:1})])),_:1})])),_:1})):V("v-if",!0),"终端"===D(I).formData.subType?(b(),v(c,{key:1,"title-align":"right","title-width":"100",onSubmit:t[23]||(t[23]=e=>D(f).showStockDateSelector=!1)},{default:k((()=>[_(o,{field:"startDate",title:"开始日期","title-width":"150","item-render":{}},{default:k((()=>[_(m,{type:"date",transfer:"",clearable:""})])),_:1}),_(o,{field:"endDate",title:"结束日期","title-width":"150","item-render":{}},{default:k((()=>[_(m,{type:"date",transfer:"",clearable:""})])),_:1}),_(o,{field:"scope","title-width":"150",title:">",span:24,"item-render":{}},{default:k((()=>[_(X,null,{default:k((()=>[U("仅医院+关联药店")])),_:1})])),_:1}),_(o,{align:"center","title-align":"left",span:24},{default:k((()=>[_(p,{status:"primary",onClick:t[22]||(t[22]=e=>D(R)("终端预估库存逻辑：\n                    1）系统取前三个月的平均值逻辑进行细化，按日期起始结束，整月的范围要考虑如何折算，如果是3月15日到6月14日，每月选择的日期/该月日历天数，完整月算作1，累加得到分母月数，15/31+2+14/30的月均销售。\n                    2）预估数 = 月均销售*预估系数。\n                    3）终端销量界定是买方类型为医院、零售连锁分店、零售单店。如勾选仅医院+关联药店，则预估的销量为仅取医院加关联药店的销量\n                    4）可以灵活设定时间段，用户可以在此选择开始结束日期。"))},{default:k((()=>[U(" 计算预估库存量 ")])),_:1})])),_:1})])),_:1})):V("v-if",!0)])),_:1},8,["modelValue"])])),_:1})}}}),[["__file","C:/Users/ThinkPad/source/Bonbonniere/bonbon-vue/src/views/c-plan/FactoryPriceReduceCreator.vue"]]);export{K as default};
